<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPERIUM SMART CLASS | Menuju Garis Finish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #1a0b14; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .gold-gradient { background: linear-gradient(to r, #fbbf24, #d97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { 
            Shield, Users, Target, Zap, Phone, MapPin, CheckCircle, 
            Clock, Star, ChevronRight, Menu, X, Instagram, Brain, 
            MessageSquare, RefreshCw, Send, Loader 
        } = lucide;

        function App() {
            const [isScrolled, setIsScrolled] = useState(false);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0 });

            // --- AI STATE ---
            const [aiMode, setAiMode] = useState('drill'); 
            const [drillCategory, setDrillCategory] = useState('TWK');
            const [drillData, setDrillData] = useState(null);
            const [userAnswer, setUserAnswer] = useState(null);
            const [chatHistory, setChatHistory] = useState([
                { role: 'model', text: 'Siap! Saya Komandan AI Imperium. Ada yang bisa saya bantu untuk strategi persiapanmu?' }
            ]);
            const [chatInput, setChatInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatEndRef = useRef(null);

            // --- AI LOGIC ---
            const callGemini = async (prompt, isJson = false) => {
                setIsLoading(true);
                // Komandan bisa ganti API Key di sini atau via Netlify Env
                const apiKey = ""; 
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

                const systemInstruction = isJson 
                    ? "Anda adalah instruktur elite untuk persiapan tes TNI/POLRI/Kedinasan. Buatkan 1 soal latihan HOTS. Output MURNI JSON: {question, options:[], correctIndex, explanation}"
                    : "Anda adalah Komandan Mentor di Imperium Smart Class. Jawab dengan tegas, ringkas, memotivasi, dan taktis. Panggil user dengan sebutan 'Calon Taruna' atau 'Siswa'.";

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    });
                    const data = await response.json();
                    setIsLoading(false);
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) return null;
                    return isJson ? JSON.parse(text.replace(/```json|```/g, "")) : text;
                } catch (error) {
                    setIsLoading(false);
                    return null;
                }
            };

            const handleGenerateDrill = async () => {
                setDrillData(null);
                setUserAnswer(null);
                const data = await callGemini(`Buatkan 1 soal pilihan ganda ${drillCategory} dengan 5 opsi.`, true);
                if (data) setDrillData(data);
            };

            const handleChatSend = async () => {
                if (!chatInput.trim()) return;
                const userMsg = chatInput;
                setChatHistory(prev => [...prev, { role: 'user', text: userMsg }]);
                setChatInput('');
                const response = await callGemini(userMsg, false);
                if (response) setChatHistory(prev => [...prev, { role: 'model', text: response }]);
            };

            useEffect(() => {
                const targetDate = new Date('2026-03-01T00:00:00');
                const interval = setInterval(() => {
                    const diff = targetDate - new Date();
                    if (diff > 0) {
                        setTimeLeft({
                            days: Math.floor(diff / 86400000),
                            hours: Math.floor((diff / 3600000) % 24),
                            minutes: Math.floor((diff / 60000) % 60),
                        });
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const scrollToSection = (id) => {
                const element = document.getElementById(id);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                    setIsMobileMenuOpen(false);
                }
            };

            return (
                <div className="text-slate-200 bg-[#1a0b14] min-h-screen selection:bg-yellow-500 selection:text-slate-900">
                    {/* Top Bar */}
                    <div className="bg-[#2D0A1E] text-white py-2 text-xs border-b border-white/10">
                        <div className="container mx-auto px-4 flex justify-between items-center">
                            <div className="flex gap-4">
